<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dynamic Fireworks Display</title>
    <style>
        body, html {
            margin: 0;
            height: 100%;
            overflow: hidden;
            background: black;
        }
        canvas {
            display: block;
        }
    </style>
</head>
<body>
    <canvas></canvas>
    <script>
        var canvas = document.querySelector('canvas');
        var ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        var fireworks = [];
        var particles = [];

        function random(min, max) {
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }

        class Firework {
            constructor(x, y) {
                this.x = x;
                this.y = y;
                this.isBlown = false;
                this.radius = 2;
                this.color = `hsl(${random(0, 360)}, 100%, 60%)`;
                this.velocity = {
                    x: Math.sin(random(-10, 10) * Math.PI / 180) * 2, // Slightly more vertical trajectory
                    y: random(-22, -18) // Increased initial velocity for a much higher peak
                };
                this.maxHeight = random(canvas.height * 0.2, canvas.height * 0.4); // Dynamic max height based on canvas size
            }

            draw() {
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
                ctx.fillStyle = this.color;
                ctx.fill();
            }

            update(index) {
                if (!this.isBlown) {
                    this.x += this.velocity.x;
                    this.y += this.velocity.y;
                    this.velocity.y += 0.3;  // Gravity effect
                }

                // Explosion triggered by reaching near the max height
                if (this.y <= this.maxHeight) {
                    this.isBlown = true;
                    this.burst();
                    fireworks.splice(index, 1);
                }
            }

            burst() {
                let count = 70;  // More particles for a broader explosion
                for (let i = 0; i < count; i++) {
                    let angle = Math.random() * Math.PI * 2;
                    let speed = random(3, 5);  // Ensuring particles spread out more
                    particles.push(new Particle(this.x, this.y, angle, speed, this.color));
                }
            }
        }

        class Particle {
            constructor(x, y, angle, speed, color) {
                this.x = x;
                this.y = y;
                this.radius = random(1, 3);
                this.color = color;
                this.velocity = {
                    x: Math.cos(angle) * speed,
                    y: Math.sin(angle) * speed
                };
                this.alpha = 1;
                this.friction = 0.98;
                this.gravity = 0.04;  // Slight gravity for radial fallout
            }

            draw() {
                ctx.save();
                ctx.globalAlpha = this.alpha;
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
                ctx.fillStyle = this.color;
                ctx.fill();
                ctx.restore();
            }

            update() {
                this.velocity.x *= this.friction;
                this.velocity.y *= this.friction;
                this.velocity.y += this.gravity;
                this.x += this.velocity.x;
                this.y += this.velocity.y;
                this.alpha -= 0.01;  // Gradual fade out for each particle
            }
        }

        function loop() {
            ctx.fillStyle = 'rgba(0, 0, 0, 0.1)';  // Slightly clearer background per frame
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            fireworks.forEach((firework, index) => firework.update(index));
            fireworks.forEach(firework => firework.draw());
            particles = particles.filter(particle => particle.alpha > 0);
            particles.forEach(particle => particle.update());
            particles.forEach(particle => particle.draw());

            if (random(0, 100) < 2) {  // Adjust frequency of fireworks if necessary
                let x = random(canvas.width * 0.1, canvas.width * 0.9);
                fireworks.push(new Firework(x, canvas.height));
            }
            requestAnimationFrame(loop);
        }

        loop();
    </script>
</body>
</html>
